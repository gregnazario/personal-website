[build]
  command = "bun install && bun run build"
  publish = "dist/client"

[dev]
  command = "bun run dev"
  targetPort = 3000
  port = 8888

[build.environment]
  BUN_VERSION = "1.3.5"

# Redirect away from the Netlify subdomain.
[[redirects]]
  from = "https://gnazario.netlify.com/*"
  to = "https://gnazar.io/:splat"
  status = 301
  force = true

# Security headers for all pages
[[headers]]
  for = "/*"
  [headers.values]
    # Prevent XSS attacks
    X-Content-Type-Options = "nosniff"
    # Prevent clickjacking
    X-Frame-Options = "DENY"
    # Control referrer information
    Referrer-Policy = "strict-origin-when-cross-origin"
    # Force HTTPS (2 years)
    Strict-Transport-Security = "max-age=63072000; includeSubDomains; preload"
    # Permissions policy - disable unnecessary features
    Permissions-Policy = "camera=(), microphone=(), geolocation=(), interest-cohort=()"
    # Content Security Policy
    Content-Security-Policy = "default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com; img-src 'self' data: https:; connect-src 'self'; frame-ancestors 'none'; base-uri 'self'; form-action 'self'"

# Cache static assets aggressively
[[headers]]
  for = "/icons/*"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  for = "/*.png"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  for = "/*.svg"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  for = "/manifest.json"
  [headers.values]
    Cache-Control = "public, max-age=86400"

# Cache JS/CSS bundles with content hash (immutable)
[[headers]]
  for = "/assets/*.js"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  for = "/assets/*.css"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

# Cache fonts
[[headers]]
  for = "/*.woff2"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  for = "/*.woff"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

# Cache images in /images folder
[[headers]]
  for = "/images/*"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"
